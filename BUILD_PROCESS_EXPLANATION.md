# Policy-Middleware Build Process

## File Structure

1. **`src/gatewaySecurity.js`** - SOURCE FILE (Edit this one!)
   - This is the original source code
   - Written in CommonJS format
   - This is the ONLY file you should edit

2. **`dist/gatewaySecurity.js`** - CommonJS Build (Auto-generated)
   - Generated by `npm run build:cjs`
   - Simply copies files from `src/` to `dist/`
   - DO NOT edit this file - it will be overwritten

3. **`dist/esm/gatewaySecurity.js`** - ESM Build (Auto-generated)
   - Generated by `npm run build:esm`
   - Converts CommonJS to ESM format
   - DO NOT edit this file - it will be overwritten

## Build Process

When you run `npm run build`:
1. `build-cjs.js` copies all files from `src/` to `dist/`
2. `build-esm.js` converts files from `src/` to `dist/esm/` (CommonJS â†’ ESM)

## Correct Workflow

1. **Edit the source file:**
   ```bash
   # Edit this file:
   src/gatewaySecurity.js
   ```

2. **Rebuild the dist files:**
   ```bash
   npm run build
   ```

3. **Test your changes:**
   ```bash
   # Test in user-service
   cd ../user-service
   npm test
   ```

## Why Your Changes Are Overwritten

- The `dist/` folder is generated from `src/`
- Running `npm run build` regenerates `dist/` from `src/`
- Any manual edits to `dist/` files are lost

## Solution

Always edit `src/gatewaySecurity.js` and then run `npm run build` to update the dist files.
